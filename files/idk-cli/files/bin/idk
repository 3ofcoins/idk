#!/bin/sh
set -e

#
# Sanitize the environment
# ------------------------
#
# Remove from environment any Bundler's, RVM's, and other
# Ruby-mangling values that may confuse our commands.

rubyvars_re='^\(rvm_.*\|RUBY_.*\|GEM_.*\|BUNDLE_.*\|MY_RUBY_HOME\|RUBYOPT\|IRBRC\)$'
for var in `env | cut -d= -f1 | grep "$rubyvars_re"` ; do
    unset $var
done

# Allow hacking IDK
unset idk_rubyopt
if [ -n "$IDK_CLI_PATH" ] ; then
    echo "# using CLI at $IDK_CLI_PATH"
    idk_rubyopt="-I$IDK_CLI_PATH/lib"
fi

export IDK0="$0"
exec /opt/idk/embedded/bin/ruby $idk_rubyopt -rubygems -ridk/cli -e '$0=ENV["IDK0"];IDK::CLI.start(ARGV)' -- "${@}"

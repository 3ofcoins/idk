#!/bin/sh

PROGNAME="`basename "$0"`"

error_exit ()
{
  echo "${PROGNAME}: ${1:-"Unknown Error"}" 1>&2
  exit 1
}

user_dir='/var/local/lib/idk/user'
mkdir -p "$user_dir" || error_exit "Cannot create $user_dir"
chmod 1777 "$user_dir"

cd /opt/idk/solo
/opt/idk/bin/chef-solo -c solo.rb -j dna.json || error_exit 'Failed chef-solo run'

ln -sf /opt/idk/bin/idk /usr/bin/ || error_exit "Cannot link idk to /usr/bin"

exit 0
